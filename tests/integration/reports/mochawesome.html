<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets\app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:5,&quot;tests&quot;:13,&quot;passes&quot;:13,&quot;pending&quot;:0,&quot;failures&quot;:0,&quot;start&quot;:&quot;2026-02-13T04:27:01.668Z&quot;,&quot;end&quot;:&quot;2026-02-13T04:27:16.648Z&quot;,&quot;duration&quot;:14980,&quot;testsRegistered&quot;:13,&quot;passPercent&quot;:100,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;8aeb83f4-0c50-4eb2-ae52-e1c4da694f7e&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0e12ab47-8649-45a0-b0ef-2b2a5a55242a&quot;,&quot;title&quot;:&quot;Consents&quot;,&quot;fullFile&quot;:&quot;D:\\apps\\test-automation\\marketing-automation-demo\\tests\\integration\\src\\consents.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\consents.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Consents\&quot;&quot;,&quot;fullTitle&quot;:&quot;Consents \&quot;before each\&quot; hook in \&quot;Consents\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1186,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;0,import_setup.beforeEachHook)()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;034610da-013c-4676-8e14-73e68993ac80&quot;,&quot;parentUUID&quot;:&quot;0e12ab47-8649-45a0-b0ef-2b2a5a55242a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Consents\&quot;&quot;,&quot;fullTitle&quot;:&quot;Consents \&quot;after all\&quot; hook in \&quot;Consents\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;0,import_setup.afterAllHook)()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b90885bb-2185-4605-a802-215994572f20&quot;,&quot;parentUUID&quot;:&quot;0e12ab47-8649-45a0-b0ef-2b2a5a55242a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;upserts consent (200)&quot;,&quot;fullTitle&quot;:&quot;Consents upserts consent (200)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:93,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const{customerId}=await(0,import_fixtures.createCustomer)();const res=await consents.upsert(customerId,{marketingOptIn:true});(0,import_chai.expect)(res.status).to.equal(200);(0,import_chai.expect)(res.json.customerId).to.equal(customerId);(0,import_chai.expect)(res.json.marketingOptIn).to.equal(true)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8826583a-69e1-40ad-bde4-f581024c698c&quot;,&quot;parentUUID&quot;:&quot;0e12ab47-8649-45a0-b0ef-2b2a5a55242a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 404 when customer does not exist&quot;,&quot;fullTitle&quot;:&quot;Consents returns 404 when customer does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const fakeId=\&quot;00000000-0000-0000-0000-000000000000\&quot;;const res=await consents.upsert(fakeId,{marketingOptIn:true});(0,import_chai.expect)(res.status).to.equal(404);(0,import_chai.expect)(res.json.error?.message).to.be.a(\&quot;string\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;00f9c577-1e0f-48d9-9bf1-5b21dbeb7c2b&quot;,&quot;parentUUID&quot;:&quot;0e12ab47-8649-45a0-b0ef-2b2a5a55242a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 400 when marketingOptIn is not boolean&quot;,&quot;fullTitle&quot;:&quot;Consents returns 400 when marketingOptIn is not boolean&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const{customerId}=await(0,import_fixtures.createCustomer)();const res=await consents.upsert(customerId,{marketingOptIn:\&quot;true\&quot;});(0,import_chai.expect)(res.status).to.equal(400);(0,import_chai.expect)(res.json.error?.message).to.be.a(\&quot;string\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;57b9b209-31e9-45f2-985e-111e32408c8c&quot;,&quot;parentUUID&quot;:&quot;0e12ab47-8649-45a0-b0ef-2b2a5a55242a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8826583a-69e1-40ad-bde4-f581024c698c&quot;,&quot;00f9c577-1e0f-48d9-9bf1-5b21dbeb7c2b&quot;,&quot;57b9b209-31e9-45f2-985e-111e32408c8c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:223,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;9fab1f8f-2205-4773-99eb-7cf206cc2f94&quot;,&quot;title&quot;:&quot;Customers&quot;,&quot;fullFile&quot;:&quot;D:\\apps\\test-automation\\marketing-automation-demo\\tests\\integration\\src\\customers.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\customers.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Customers\&quot;&quot;,&quot;fullTitle&quot;:&quot;Customers \&quot;before each\&quot; hook in \&quot;Customers\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:833,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;0,import_setup.beforeEachHook)()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b8513b44-2f5d-4fdb-a3b1-e3a4989a28a8&quot;,&quot;parentUUID&quot;:&quot;9fab1f8f-2205-4773-99eb-7cf206cc2f94&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Customers\&quot;&quot;,&quot;fullTitle&quot;:&quot;Customers \&quot;after all\&quot; hook in \&quot;Customers\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;0,import_setup.afterAllHook)()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0fa07740-7b52-4de3-bf44-fe3d134233d2&quot;,&quot;parentUUID&quot;:&quot;9fab1f8f-2205-4773-99eb-7cf206cc2f94&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;creates customer (201)&quot;,&quot;fullTitle&quot;:&quot;Customers creates customer (201)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const res=await customers.create({externalId:`crm-${Date.now()}`,fullName:\&quot;Customer 1\&quot;,attributes:{segment:\&quot;MORTGAGE_INTEREST\&quot;}});(0,import_chai.expect)(res.status).to.equal(201);(0,import_chai.expect)(res.json).to.have.property(\&quot;id\&quot;);(0,import_chai.expect)(res.json.externalId).to.be.a(\&quot;string\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0f21295d-f8dd-4ea2-bdda-3f377a7e0efe&quot;,&quot;parentUUID&quot;:&quot;9fab1f8f-2205-4773-99eb-7cf206cc2f94&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 409 on duplicate externalId&quot;,&quot;fullTitle&quot;:&quot;Customers returns 409 on duplicate externalId&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const externalId=`crm-dup-${Date.now()}`;const a=await customers.create({externalId});(0,import_chai.expect)(a.status).to.equal(201);const b=await customers.create({externalId});(0,import_chai.expect)(b.status).to.equal(409);(0,import_chai.expect)(b.json.error?.message).to.be.a(\&quot;string\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a90116a7-518b-4ea4-ad0c-be166e245ac6&quot;,&quot;parentUUID&quot;:&quot;9fab1f8f-2205-4773-99eb-7cf206cc2f94&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 400 when externalId is missing&quot;,&quot;fullTitle&quot;:&quot;Customers returns 400 when externalId is missing&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const res=await customers.create({externalId:\&quot;\&quot;});(0,import_chai.expect)(res.status).to.equal(400);(0,import_chai.expect)(res.json.error?.message).to.be.a(\&quot;string\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e07d6155-ab51-426d-b7f7-1138a3d60bda&quot;,&quot;parentUUID&quot;:&quot;9fab1f8f-2205-4773-99eb-7cf206cc2f94&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0f21295d-f8dd-4ea2-bdda-3f377a7e0efe&quot;,&quot;a90116a7-518b-4ea4-ad0c-be166e245ac6&quot;,&quot;e07d6155-ab51-426d-b7f7-1138a3d60bda&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:59,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;2ec6eb82-ea5e-41ef-9ae1-5c9049a86813&quot;,&quot;title&quot;:&quot;E2E flow&quot;,&quot;fullFile&quot;:&quot;D:\\apps\\test-automation\\marketing-automation-demo\\tests\\integration\\src\\e2e-flow.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\e2e-flow.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;E2E flow\&quot;&quot;,&quot;fullTitle&quot;:&quot;E2E flow \&quot;before each\&quot; hook in \&quot;E2E flow\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1153,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;0,import_setup.beforeEachHook)()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;19240b11-1089-4709-a0a0-ae93cd382b77&quot;,&quot;parentUUID&quot;:&quot;2ec6eb82-ea5e-41ef-9ae1-5c9049a86813&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;E2E flow\&quot;&quot;,&quot;fullTitle&quot;:&quot;E2E flow \&quot;after all\&quot; hook in \&quot;E2E flow\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;0,import_setup.afterAllHook)()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2144e09f-f50f-4b51-bc2d-b403186a5f5c&quot;,&quot;parentUUID&quot;:&quot;2ec6eb82-ea5e-41ef-9ae1-5c9049a86813&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;customer -&gt; consent -&gt; idempotent event -&gt; next offer&quot;,&quot;fullTitle&quot;:&quot;E2E flow customer -&gt; consent -&gt; idempotent event -&gt; next offer&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:679,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const externalId=`crm-${Date.now()}`;const created=await customers.create({externalId,fullName:\&quot;E2E User\&quot;,attributes:{segment:\&quot;MORTGAGE_INTEREST\&quot;}});(0,import_chai.expect)(created.status).to.equal(201);const customerId=created.json.id;const consentRes=await consents.upsert(customerId,{marketingOptIn:true});(0,import_chai.expect)(consentRes.status).to.equal(200);const idemKey=`evt-${customerId}-view-mortgage-001`;const e1=await events.ingest({customerId,eventType:\&quot;VIEW_MORTGAGE\&quot;,idempotencyKey:idemKey,payload:{page:\&quot;/mortgage\&quot;}});(0,import_chai.expect)(e1.status).to.equal(201);const e2=await events.ingest({customerId,eventType:\&quot;VIEW_MORTGAGE\&quot;,idempotencyKey:idemKey,payload:{page:\&quot;/mortgage\&quot;}});(0,import_chai.expect)(e2.status).to.equal(200);(0,import_chai.expect)(e2.json.id).to.equal(e1.json.id);const cnt=await(0,import_dbClient.queryOne)(`SELECT count(*)::text as cnt FROM events WHERE idempotency_key = $1`,[idemKey]);(0,import_chai.expect)(cnt?.cnt).to.equal(\&quot;1\&quot;);const next=await offers.next(customerId);(0,import_chai.expect)(next.status).to.equal(200);(0,import_chai.expect)(next.json.hasOffer).to.equal(true);(0,import_chai.expect)(next.json.offer?.offerCode).to.equal(\&quot;MORTGAGE_PROMO_01\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ff4cee62-c89e-4ffd-aeb8-fe761803fc29&quot;,&quot;parentUUID&quot;:&quot;2ec6eb82-ea5e-41ef-9ae1-5c9049a86813&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ff4cee62-c89e-4ffd-aeb8-fe761803fc29&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:679,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;0bed07e7-b814-4252-badb-f88bbd2c02a8&quot;,&quot;title&quot;:&quot;Events&quot;,&quot;fullFile&quot;:&quot;D:\\apps\\test-automation\\marketing-automation-demo\\tests\\integration\\src\\events.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\events.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Events\&quot;&quot;,&quot;fullTitle&quot;:&quot;Events \&quot;before each\&quot; hook in \&quot;Events\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1078,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;0,import_setup.beforeEachHook)()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e76464f1-c77b-4076-9b66-add6abe9d43d&quot;,&quot;parentUUID&quot;:&quot;0bed07e7-b814-4252-badb-f88bbd2c02a8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Events\&quot;&quot;,&quot;fullTitle&quot;:&quot;Events \&quot;after all\&quot; hook in \&quot;Events\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;0,import_setup.afterAllHook)()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7580035b-fead-43a3-9997-b234343ad5c7&quot;,&quot;parentUUID&quot;:&quot;0bed07e7-b814-4252-badb-f88bbd2c02a8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;is idempotent by idempotencyKey (201 then 200, same id/createdAt)&quot;,&quot;fullTitle&quot;:&quot;Events is idempotent by idempotencyKey (201 then 200, same id/createdAt)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:157,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const{customerId}=await(0,import_fixtures.createCustomer)();const key=`evt-${customerId}-view-mortgage-001`;const e1=await events.ingest({customerId,eventType:\&quot;VIEW_MORTGAGE\&quot;,idempotencyKey:key,payload:{page:\&quot;/mortgage\&quot;}});(0,import_chai.expect)(e1.status).to.equal(201);(0,import_chai.expect)(e1.json.isDuplicate).to.equal(false);const e2=await events.ingest({customerId,eventType:\&quot;VIEW_MORTGAGE\&quot;,idempotencyKey:key,payload:{page:\&quot;/mortgage\&quot;}});(0,import_chai.expect)(e2.status).to.equal(200);(0,import_chai.expect)(e2.json.isDuplicate).to.equal(true);(0,import_chai.expect)(e2.json.id).to.equal(e1.json.id);(0,import_chai.expect)(e2.json.createdAt).to.equal(e1.json.createdAt);const row=await(0,import_dbClient.queryOne)(`SELECT count(*)::text as cnt FROM events WHERE idempotency_key = $1`,[key]);(0,import_chai.expect)(row?.cnt).to.equal(\&quot;1\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1edccb43-ea92-4f0c-ac72-0992b44b7f3f&quot;,&quot;parentUUID&quot;:&quot;0bed07e7-b814-4252-badb-f88bbd2c02a8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 404 when customer does not exist&quot;,&quot;fullTitle&quot;:&quot;Events returns 404 when customer does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const fakeId=\&quot;00000000-0000-0000-0000-000000000000\&quot;;const res=await events.ingest({customerId:fakeId,eventType:\&quot;VIEW_MORTGAGE\&quot;,idempotencyKey:\&quot;evt-nonexistent-0001\&quot;,payload:{}});(0,import_chai.expect)(res.status).to.equal(404);(0,import_chai.expect)(res.json.error?.message).to.be.a(\&quot;string\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;70ce03e6-1e2c-45a8-be29-6e78c8703b3a&quot;,&quot;parentUUID&quot;:&quot;0bed07e7-b814-4252-badb-f88bbd2c02a8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 400 when idempotencyKey is too short&quot;,&quot;fullTitle&quot;:&quot;Events returns 400 when idempotencyKey is too short&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const{customerId}=await(0,import_fixtures.createCustomer)();const res=await events.ingest({customerId,eventType:\&quot;VIEW_MORTGAGE\&quot;,idempotencyKey:\&quot;short\&quot;,payload:{}});(0,import_chai.expect)(res.status).to.equal(400);(0,import_chai.expect)(res.json.error?.message).to.be.a(\&quot;string\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;634312ed-c08a-49e1-b666-4b05bc4feeb4&quot;,&quot;parentUUID&quot;:&quot;0bed07e7-b814-4252-badb-f88bbd2c02a8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1edccb43-ea92-4f0c-ac72-0992b44b7f3f&quot;,&quot;70ce03e6-1e2c-45a8-be29-6e78c8703b3a&quot;,&quot;634312ed-c08a-49e1-b666-4b05bc4feeb4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:198,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;6d29ff5b-4d90-44fe-94c3-621b46be8a00&quot;,&quot;title&quot;:&quot;Offers (Next Best Offer)&quot;,&quot;fullFile&quot;:&quot;D:\\apps\\test-automation\\marketing-automation-demo\\tests\\integration\\src\\offers.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\offers.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Offers (Next Best Offer)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Offers (Next Best Offer) \&quot;before each\&quot; hook in \&quot;Offers (Next Best Offer)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1051,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;0,import_setup.beforeEachHook)()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;58d8a499-e800-4a71-90cb-18832ce24575&quot;,&quot;parentUUID&quot;:&quot;6d29ff5b-4d90-44fe-94c3-621b46be8a00&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Offers (Next Best Offer)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Offers (Next Best Offer) \&quot;after all\&quot; hook in \&quot;Offers (Next Best Offer)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;0,import_setup.afterAllHook)()&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9886bd11-8794-4cf6-ad9d-5b99cd9c6411&quot;,&quot;parentUUID&quot;:&quot;6d29ff5b-4d90-44fe-94c3-621b46be8a00&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns NO_MARKETING_CONSENT and does not insert into offers&quot;,&quot;fullTitle&quot;:&quot;Offers (Next Best Offer) returns NO_MARKETING_CONSENT and does not insert into offers&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:95,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const{customerId}=await(0,import_fixtures.createCustomer)();const next=await offers.next(customerId);(0,import_chai.expect)(next.status).to.equal(200);(0,import_chai.expect)(next.json.hasOffer).to.equal(false);(0,import_chai.expect)(next.json.reason).to.equal(\&quot;NO_MARKETING_CONSENT\&quot;);const row=await(0,import_dbClient.queryOne)(`SELECT count(*)::text as cnt FROM offers WHERE customer_id = $1`,[customerId]);(0,import_chai.expect)(row?.cnt).to.equal(\&quot;0\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d1f81177-d3bf-422b-86d4-84b1dd6815f9&quot;,&quot;parentUUID&quot;:&quot;6d29ff5b-4d90-44fe-94c3-621b46be8a00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns NO_RELEVANT_EVENT when consent true but no event&quot;,&quot;fullTitle&quot;:&quot;Offers (Next Best Offer) returns NO_RELEVANT_EVENT when consent true but no event&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:76,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const{customerId}=await(0,import_fixtures.createCustomerWithConsent)(true);const next=await offers.next(customerId);(0,import_chai.expect)(next.status).to.equal(200);(0,import_chai.expect)(next.json.hasOffer).to.equal(false);(0,import_chai.expect)(next.json.reason).to.equal(\&quot;NO_RELEVANT_EVENT\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2c98ece7-cc44-444e-b438-c6ee53f0c7f9&quot;,&quot;parentUUID&quot;:&quot;6d29ff5b-4d90-44fe-94c3-621b46be8a00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns offer and inserts decision record when eligible&quot;,&quot;fullTitle&quot;:&quot;Offers (Next Best Offer) returns offer and inserts decision record when eligible&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:110,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const{customerId}=await(0,import_fixtures.createCustomerConsentAndMortgageEvent)();const next=await offers.next(customerId);(0,import_chai.expect)(next.status).to.equal(200);(0,import_chai.expect)(next.json.hasOffer).to.equal(true);(0,import_chai.expect)(next.json.offer?.offerCode).to.equal(\&quot;MORTGAGE_PROMO_01\&quot;);const offerRow=await(0,import_dbClient.queryOne)(`SELECT offer_code FROM offers WHERE customer_id = $1 ORDER BY created_at DESC LIMIT 1`,[customerId]);(0,import_chai.expect)(offerRow?.offer_code).to.equal(\&quot;MORTGAGE_PROMO_01\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a475b222-8564-4e3a-9336-f5598e1d2616&quot;,&quot;parentUUID&quot;:&quot;6d29ff5b-4d90-44fe-94c3-621b46be8a00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d1f81177-d3bf-422b-86d4-84b1dd6815f9&quot;,&quot;2c98ece7-cc44-444e-b438-c6ee53f0c7f9&quot;,&quot;a475b222-8564-4e3a-9336-f5598e1d2616&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:281,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:30000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;11.7.5&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:true,&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.4&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;reportDir&quot;:&quot;reports&quot;,&quot;overwrite&quot;:&quot;true&quot;,&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;quiet&quot;:&quot;true&quot;},&quot;version&quot;:&quot;6.3.2&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;reportDir&quot;:&quot;reports&quot;,&quot;reportTitle&quot;:&quot;integration&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;reports\\assets&quot;,&quot;jsonFile&quot;:&quot;D:\\apps\\test-automation\\marketing-automation-demo\\tests\\integration\\reports\\mochawesome.json&quot;,&quot;htmlFile&quot;:&quot;D:\\apps\\test-automation\\marketing-automation-demo\\tests\\integration\\reports\\mochawesome.html&quot;}"><div id="report"></div><script src="assets\app.js"></script></body></html>